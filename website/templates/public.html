{% extends "base.html" %}

{% block title %}Public Page{% endblock %}

{% block head %}
    {% load static %}
    <link rel="stylesheet" href="{% static 'css/public.css' %}"> 
{% endblock %}

{% block content %}
<!-- stopping the scrolling btn -->
<a href="#" id="stop"></a>
    <!-- <span>Current Time : {{current_time}}</span><br>
    <span>Today's Date : {{today_date}}</span> -->
    <h1>
        {% if greeting %}
            {{greeting}} 
        {% else %} 
        Hello 
        {% endif %} 
            {{user.username|title}}!
    </h1>
    <img class="current_user_img" src="{{ user_profile.profile_picture.url }}" alt="" style="width: 50px; height: 50px">
    
    <h2>Public Page</h2>
    
    
    <div class="addpost-box">
        <div>
            <h2>Add a post :</h2>
            <form action="{% url 'add_post' %}" method="POST" enctype="multipart/form-data">
                {% csrf_token %}
                    <label for="file">Upload Image : </label>
                    <input type="file" id="file" name="post_img" >
                    <br><br>
                    <label for="post_caption">Add Status : </label>
                    <textarea name="post_caption" id="post_caption" cols="40" rows="2" placeholder="Write Your Captions Here..."></textarea>
                    <br><br>
                    <button type='submit'>POST</button>
            </form>
         </div>
        
    </div>

     <!-- seaarch users div -->
     <div class="search-div">
        <h2>Search Users : </h2>
        <form action="{% url 'search_users' %}" method="GET">   <!-- this goes to public_page -->
            <input type="text" name="query" placeholder="Search by username.." autocomplete="off">
            <button type="submit">Search</button>
        </form>
        
        <div>
            {% if search_results %}
            <h2>Search Results</h2>
                {% for user in search_results %}
                    <div class="search-result">
                        <img src="{{ user.userprofile.profile_picture.url }}" alt="" style="width: 40px; height: 40px; border-radius: 20px;">
                        <span>@{{user.username }}</span>
                        <a href="{% url 'profile' pk=user.username %}">View Profile </a>
                    </div>
                {% endfor %}
            {% endif %}
        </div>
    </div>

    <!-- user suggestions div -->
    <div class="user-suggestion">
        <h3>People you May know : </h3>
        <div>
            
            {% for sug_user in suggested_users %}
                <div>
                    <img src="{{ sug_user.userprofile.profile_picture.url }}" alt="" style="width: 40px; height: 40px; border-radius: 20px;">
                    <span>@{{sug_user.username }}</span>
                    <a href="{% url 'profile' pk=sug_user.username %}">View Profile </a>
                </div>
            {% endfor %}
        </div>
    </div>

    

    <!-- all feeds of the following users -->
    <div class="post_box">
        
       
            {% for post in posts reversed %}  <!-- making the latest post on the top  -->
                <div class="single_post">
                    <div>
                        <div class="profile_img_del-div">
                            <a href="{% url 'profile' pk=post.user %}">
                                <img src="{{ post.user.userprofile.profile_picture.url }}" alt="" style="width: 35px; height: 35px; border-radius: 50%;border: 1px double black;">
                                <span >@{{ post.user.username }}</span>
                            </a>

                            <!-- deleting post -->
                            {% if post.user == user_profile.user %}
                            <form action="{% url 'delete_post' post.id %}" onsubmit="return confirm('Are you sure you want to delete your Post ?')" >
                                {% csrf_token %}
                                <button type="submit">Delete Post</button>
                            </form>
                            <!-- href="/delete_post?post_id={{post.id}}  -->
                                
                            {% endif %}
                            
                        </div>

                        <p>Posted at : <span>{{ post.created_at }}</span></p>
                    </div>
                    <!-- image section of post -->
                    <div class="image-post-div">
                        <img src="{{ post.image.url }}" alt="" >
                        <br>
                        <div style="border: 1px solid green; width: 98%;">{{ post.caption }}</div>
                    </div>
                    <div>
                        <!-- like section of post -->
                        
                        <li>{{post.no_of_likes}}  <a href="/like_post?post_id={{post.id}} ">Like</a>
                            <!-- <i class="fas fa-heart"></i> -->
                                <!-- {% if like.user == user.id  %}
                                    <a href="/like_post?post_id={{post.id}} ">Unlike</a>
                                {% else %}
                                    <a href="/like_post?post_id={{post.id}} ">Like</a>
                                {% endif %} -->
                        </li> 
                        <li id="cmt_btn">{{post.no_of_comments}} Comments</li>
                        <a href="{{ post.image.url }}" download ><li>Save</li></a>
                    </div>
                    <!-- comment section of post -->
                    <div id="cmt_box">
                        <form action="{% url 'comment' %}" method="POST">
                            {% csrf_token %}
                            <input type="hidden" name="po_usr" value="{{ post.user}}">  <!-- user id of the user whose the post is  -->
                            <input type="hidden" name="po_id" value="{{ post.id }}">    <!-- post id -->

                            <label for=""><img src="{{ user_profile.profile_picture.url }}" alt="" style="width: 20px; height: 20px; border-radius: 50%;"></label>
                            <input type="text" name="cmt_content" placeholder="Write your comments...">
                            <button>post</button>
                        </form>
                        <ul>
                            {% for comment in comments %}
                                {% if comment.post_id == post.id %}
                                    <li class="cmt-li">
                                        <span>
                                            <img src="{{ comment.user.userprofile.profile_picture.url }}" alt="Profile Picture" style="width: 20px; height: 20px; border-radius: 50%; border: 1px double red;">@{{ comment.user.username }} :
                                            "{{ comment.content }}"
                                            at {{ comment.commented_at }}
                                        </span>
                                        <!-- delete comment part  -->
                                        <span>
                                            <form action="{% url 'delete_comment' comment.id %}" method="post" onsubmit="return confirm('Are you sure you want to delete your comment ?');">
                                                {% csrf_token %}
                                                {% if comment.user == user_profile.user %}  <!-- if the coment user_id and current user user_id same then only delete button is seen -->
                                                    <button  type="submit" style="color: red; cursor: pointer;" ><i class="fas fa-times"></i></button>
                                                {% endif %}
                                            </form>
                                        </span>
                                    </li><br>
                                {% endif %}
                            {% endfor %}
                        </ul>
                    </div>
                    
                </div>
                
            {% endfor %}
    </div>
    <div id="scrlUpBOx" style="cursor: pointer;">
        <span id="goTop"><i class="fa-solid fa-arrow-turn-up"></i>Go Up</span>
    </div>
    <!-- scrolling up btn  -->
    <script src="{% static 'js/public.js' %}"></script>
    
{% endblock %}